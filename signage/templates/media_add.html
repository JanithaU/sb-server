{% extends "layout.html" %}
{% block content %}
<h2>Media<a class="btn btn-info btn-sm float-right" href="{{ url_for('media')}}" role="button">Go Back</a></h2>
<hr>
<div class="col-md-6">
	<div class ="content-section">
		<form method="POST" action="" enctype="multipart/form-data" {%if not update %} id='upload' {% endif %}>
			{{ form.hidden_tag() }}
			<fieldset class="form-group">
			<legend class="border-bottom mb-4">{{legend}}</legend>

<!-- To change to branch relation -->


			<div class="form-group">
				{{ form.media_name.label(class="form-control-label") }}

				{% if not update %}
					{% if form.media_name.errors %}
						{{ form.media_name(class="form-control form-control-lg is-invalid")}}
						<div class="invalid-feedback">
							{% for error in form.media_name.errors %}
								<span>{{ error }}</span>
							{% endfor %}
						</div>
					{% else %}
						{{ form.media_name(class="form-control form-control-lg") }}
					{% endif %}
					
			{% else %}	
			<input class="form-control form-control-lg" id="media_name" name="media_name" disabled type=	"text" value="{{form.media_name.data}}">
			<input class="form-control form-control-lg" id="media_name" name="media_name"  type="hidden" value="{{form.media_name.data}}">
			{% endif %}
			</div>

		{% if not update %}
			<div class="form-group">
				{{ form.media_file.label() }}	
					{{ form.media_file(class="form-control-file", id="media_file") }}
					{% if form.media_file.errors %}
						{% for error in form.media_file.errors %}
								<span class="text-danger">{{ error }}</span></div></br>
						{% endfor %}
				{% endif %}
				
			</div>
				<div class="progress">
				  <div id="progressBar" class="progress-bar" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="width: 0%;">
				    0%
				  </div>
				</div>
		{% endif %}
			<div class="form-group">
				{{ form.description.label(class="form-control-text") }}
				{% if form.description.errors %}
					{{ form.description(class="form-control form-control-text is-invalid")}}
					<div class="invalid-feedback">
						{% for error in form.description.errors %}
							<span>{{ error }}</span>
						{% endfor %}
					</div>
				{% else %}
					{{ form.description(class="form-control form-control-text") }}
				{% endif %}
			</div>

			<div class="form-group">
				{{ form.active_status.label(class="form-control-checkbox") }}

				{% if form.active_status.errors %}
					{{ form.active_status(class="form-control checkbox-inline is-invalid")}}
					<div class="invalid-feedback">
						{% for error in form.active_status.errors %}
							<span>{{ error }}</span>
						{% endfor %}
					</div>
				{% else %}
					{{ form.active_status(class="checkbox-inline") }}
				{% endif %}
				
			</div>
			
			<input type="hidden" id="media_duration" name="media_duration" value="">

			<div class="form-group">
				{{ form.submit(class="btn btn-outline-info") }}
				<a class="btn btn-outline-secondary" href="{{ url_for('media')}}" role="button">Cancel</a>	
			</div>

			</fieldset>
		</form>
					


	</div>
</div>
	

<script type="text/javascript">
  var vid = document.createElement('video');
	document.querySelector('#media_file').addEventListener('change', function() {
  // create url to use as the src of the video
  var fileURL = URL.createObjectURL(this.files[0]);
  vid.src = fileURL;
  // wait for duration to change from NaN to the actual duration
  vid.ondurationchange = function() {
  	document.getElementById("media_duration").value = this.duration;
  };
});

  
</script>

{% endblock content %}
